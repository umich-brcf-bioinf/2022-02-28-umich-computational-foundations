<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Wrangling and Analyses with Tidyverse</title>

<script src="site_libs/header-attrs-2.11/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link rel="shortcut icon" href="favicon-16x16.png" />
<!--
Favicon from
https://twemoji.twitter.com/
https://favicon.io/emoji-favicons/computer/
-->

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>








<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Computational Foundations</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="Module00_Introduction.html">Intro</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bash Shell
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="bash-01-introduction.html">Introducing the Shell</a>
    </li>
    <li>
      <a href="bash-02-the-filesystem.html">Navigating Files and Directories</a>
    </li>
    <li>
      <a href="bash-03-working-with-files.html">Working with Files</a>
    </li>
    <li>
      <a href="bash-04-redirection.html">Redirection</a>
    </li>
    <li>
      <a href="bash-05-writing-scripts.html">Writing Scripts and Working with Data</a>
    </li>
    <li>
      <a href="bash-06-organization.html">Project Organization</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R and RStudio
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="r-01-introduction.html">Introducing R and RStudio IDE</a>
    </li>
    <li>
      <a href="r-02-r-basics.html">R Basics</a>
    </li>
    <li>
      <a href="r-03-basics-factors-dataframes.html">R Basics Continued - Factors and Data Frames</a>
    </li>
    <li>
      <a href="r-04-bioconductor.html">Using Packages from Bioconductor</a>
    </li>
    <li>
      <a href="r-05-dplyr.html">Data Wrangling and Analyses with Tidyverse</a>
    </li>
    <li>
      <a href="r-06-data-visualization.html">Data Visualizations with ggplot2</a>
    </li>
    <li>
      <a href="r-07-r-help.html">Getting Help with R</a>
    </li>
  </ul>
</li>
<li>
  <a href="Module99_Wrap_up.html">Wrap up</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data Wrangling and Analyses with
Tidyverse</h1>

</div>


<style type="text/css">

body, td {
   font-size: 18px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}

</style>
<!--
---
title: "Data Wrangling and Analyses with Tidyverse"
teaching: 40
exercises: 15
questions: How can I manipulate data frames without repeating myself?
objectives:
- Describe what the `dplyr` package in R is used for.
- Apply common `dplyr` functions to manipulate data in R.
- Employ the ‘pipe’ operator to link together a sequence of functions.
- Employ the ‘mutate’ function to apply other chosen functions to existing columns and create new columns of data.
- Employ the ‘split-apply-combine’ concept to split the data into groups, apply analysis to each group, and combine the results.
keypoints:
- Use the `dplyr` package to manipulate data frames.
- Use `glimpse()` to quickly look at your data frame.
- Use `select()` to choose variables from a data frame.
- Use `filter()` to choose data based on values.
- Use `mutate()` to create new variables.
- Use `group_by()` and `summarize()` to work with subsets of data.
source: Rmd
---
-->
<p>Bracket subsetting is handy, but it can be cumbersome and difficult
to read, especially for complicated operations.</p>
<p>Luckily, the <a
href="https://cran.r-project.org/package=dplyr"><code>dplyr</code></a>
package provides a number of very useful functions for manipulating data
frames in a way that will reduce repetition, reduce the probability of
making errors, and probably even save you some typing. As an added
bonus, you might even find the <code>dplyr</code> grammar easier to
read.</p>
<p>Here we’re going to cover some of the most commonly used functions as
well as using pipes (<code>%&gt;%</code>) to combine them:</p>
<ol style="list-style-type: decimal">
<li><code>glimpse()</code></li>
<li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li><code>mutate()</code></li>
<li><code>pivot_longer</code> and <code>pivot_wider</code></li>
</ol>
<p>Packages in R are sets of additional functions that let you do more
stuff in R. The functions we’ve been using, like <code>str()</code>,
come built into R; packages give you access to more functions. You need
to install a package and then load it to be able to use it.</p>
<pre class="r"><code>install.packages(&quot;dplyr&quot;) ## install</code></pre>
<p>You might get asked to choose a CRAN mirror – this is asking you to
choose a site to download the package from. The choice doesn’t matter
too much; I’d recommend choosing the RStudio mirror.</p>
<pre class="r"><code>library(&quot;dplyr&quot;)          ## load</code></pre>
<p>You only need to install a package once per computer, but you need to
load it every time you open a new R session and want to use that
package.</p>
<div id="what-is-dplyr" class="section level2">
<h2>What is dplyr?</h2>
<p>The package <code>dplyr</code> is a package that tries to provide
easy tools for the most common data manipulation tasks. This package is
also included in the <a
href="https://www.tidyverse.org/"><code>tidyverse</code> package</a>,
which is a collection of eight different packages (<code>dplyr</code>,
<code>ggplot2</code>, <code>tibble</code>, <code>tidyr</code>,
<code>readr</code>, <code>purrr</code>, <code>stringr</code>, and
<code>forcats</code>). It is built to work directly with data frames.
The thinking behind it was largely inspired by the package
<code>plyr</code> which has been in use for some time but suffered from
being slow in some cases.<code>dplyr</code> addresses this by porting
much of the computation to C++. An additional feature is the ability to
work with data stored directly in an external database. The benefits of
doing this are that the data can be managed natively in a relational
database, queries can be conducted on that database, and only the
results of the query returned.</p>
<p>This addresses a common problem with R in that all operations are
conducted in memory and thus the amount of data you can work with is
limited by available memory. The database connections essentially remove
that limitation in that you can have a database that is over 100s of GB,
conduct queries on it directly and pull back just what you need for
analysis in R.</p>
<div id="taking-a-quick-look-at-data-frames" class="section level3">
<h3>Taking a quick look at data frames</h3>
<p>Similar to <code>str()</code>, which comes built into R,
<code>glimpse()</code> is a <code>dplyr</code> function that (as the
name suggests) gives a glimpse of the data frame.</p>
<pre><code>Rows: 1,704
Columns: 6
$ country     &lt;chr&gt; &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;, &quot;Afghanistan&quot;…
$ year        &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997…
$ pop         &lt;dbl&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, …
$ continent   &lt;chr&gt; &quot;Asia&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;Asia&quot;, &quot;A…
$ life_exp    &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40…
$ gdp_per_cap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134…</code></pre>
<p>In the above output, we can already gather some information about
<code>gapminder</code>, such as the number of rows and columns, column
names, type of vector in the columns, and the first few entries of each
column. Although what we see is similar to outputs of
<code>str()</code>, this method gives a cleaner visual output.</p>
<blockquote>
<h2 id="note-what-is-a-tibble">Note: What is a <code>tibble</code>?</h2>
<p>In the <code>tidyverse</code> there is a specialized version of a
<code>data.frame</code> called a <code>tibble</code>. It largely behaves
like a <code>data.frame</code>, but it has some considerate defaults
when displaying its contents. We shall encounter some differences as we
work through this section, and will highlight them as we go.</p>
</blockquote>
</div>
<div id="coercing-to-a-tibble" class="section level3">
<h3>Coercing to a <code>tibble</code></h3>
<p>Let’s coerce our <code>gapminder</code> <code>data.frame</code> into
a <code>tibble</code> using the <code>as_tibble()</code> function. Let’s
first do this without assigning the result:</p>
<pre class="r"><code>as_tibble(gapminder)</code></pre>
<pre><code># A tibble: 1,704 × 6
   country      year      pop continent life_exp gdp_per_cap
   &lt;chr&gt;       &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1 Afghanistan  1952  8425333 Asia          28.8        779.
 2 Afghanistan  1957  9240934 Asia          30.3        821.
 3 Afghanistan  1962 10267083 Asia          32.0        853.
 4 Afghanistan  1967 11537966 Asia          34.0        836.
 5 Afghanistan  1972 13079460 Asia          36.1        740.
 6 Afghanistan  1977 14880372 Asia          38.4        786.
 7 Afghanistan  1982 12881816 Asia          39.9        978.
 8 Afghanistan  1987 13867957 Asia          40.8        852.
 9 Afghanistan  1992 16317921 Asia          41.7        649.
10 Afghanistan  1997 22227415 Asia          41.8        635.
# … with 1,694 more rows</code></pre>
<p>What do you notice?</p>
<ul>
<li>The preview helpfully tells us the dimensions at the top
<code># A tibble: 1,704 × 6</code>.</li>
<li>The preview helpfully truncates the output as if we used
<code>head()</code>.</li>
<li>The preview tells us the <code>mode()</code> of each of the
columns.</li>
</ul>
<p>To drive home the difference, do the following:</p>
<pre class="r"><code>gapminder</code></pre>
<p>And notice that no such conveniences are afforded to us. So for the
remainder, we will coerce <code>gapminder</code> into a
<code>tibble</code>. However, we may interchangeably refer to a
<code>tibble</code> or a <code>data.frame</code>.</p>
<pre class="r"><code>gapminder &lt;- as_tibble(gapminder)</code></pre>
</div>
<div id="selecting-columns-and-filtering-rows" class="section level3">
<h3>Selecting columns and filtering rows</h3>
<p>To select columns of a data frame, use <code>select()</code>. The
first argument to this function is the data frame
(<code>gapminder</code>), and the subsequent arguments are the columns
to keep.</p>
<pre class="r"><code>select(gapminder, country, year, gdp_per_cap)</code></pre>
<pre><code># A tibble: 1,704 × 3
   country      year gdp_per_cap
   &lt;chr&gt;       &lt;int&gt;       &lt;dbl&gt;
 1 Afghanistan  1952        779.
 2 Afghanistan  1957        821.
 3 Afghanistan  1962        853.
 4 Afghanistan  1967        836.
 5 Afghanistan  1972        740.
 6 Afghanistan  1977        786.
 7 Afghanistan  1982        978.
 8 Afghanistan  1987        852.
 9 Afghanistan  1992        649.
10 Afghanistan  1997        635.
# … with 1,694 more rows</code></pre>
<p>To select all columns <em>except</em> certain ones, put a “-” in
front of the variable to exclude it.</p>
<pre class="r"><code>select(gapminder, -life_exp)</code></pre>
<pre><code># A tibble: 1,704 × 5
   country      year      pop continent gdp_per_cap
   &lt;chr&gt;       &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 Afghanistan  1952  8425333 Asia             779.
 2 Afghanistan  1957  9240934 Asia             821.
 3 Afghanistan  1962 10267083 Asia             853.
 4 Afghanistan  1967 11537966 Asia             836.
 5 Afghanistan  1972 13079460 Asia             740.
 6 Afghanistan  1977 14880372 Asia             786.
 7 Afghanistan  1982 12881816 Asia             978.
 8 Afghanistan  1987 13867957 Asia             852.
 9 Afghanistan  1992 16317921 Asia             649.
10 Afghanistan  1997 22227415 Asia             635.
# … with 1,694 more rows</code></pre>
<p><code>dplyr</code> also provides useful functions to select columns
based on their names. For instance, <code>ends_with()</code> allows you
to select columns that ends with specific letters. For instance, if you
wanted to select columns that end with the letter “p”:</p>
<pre class="r"><code>select(gapminder, ends_with(&quot;p&quot;))</code></pre>
<pre><code># A tibble: 1,704 × 3
        pop life_exp gdp_per_cap
      &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
 1  8425333     28.8        779.
 2  9240934     30.3        821.
 3 10267083     32.0        853.
 4 11537966     34.0        836.
 5 13079460     36.1        740.
 6 14880372     38.4        786.
 7 12881816     39.9        978.
 8 13867957     40.8        852.
 9 16317921     41.7        649.
10 22227415     41.8        635.
# … with 1,694 more rows</code></pre>
<blockquote>
<h2 id="challenge">Challenge</h2>
<p>Create a table that contains all the columns with the letter “e” and
column “country”, without columns “life_exp”. Hint: look at the help
function <code>tidyselect::ends_with()</code> we’ve just covered.</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<pre class="r"><code>select(gapminder, contains(&quot;e&quot;), -life_exp, country)</code></pre>
<pre><code># A tibble: 1,704 × 4
    year continent gdp_per_cap country    
   &lt;int&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;      
 1  1952 Asia             779. Afghanistan
 2  1957 Asia             821. Afghanistan
 3  1962 Asia             853. Afghanistan
 4  1967 Asia             836. Afghanistan
 5  1972 Asia             740. Afghanistan
 6  1977 Asia             786. Afghanistan
 7  1982 Asia             978. Afghanistan
 8  1987 Asia             852. Afghanistan
 9  1992 Asia             649. Afghanistan
10  1997 Asia             635. Afghanistan
# … with 1,694 more rows</code></pre>
</details>
<p><br></p>
<p>To choose rows, use <code>filter()</code>:</p>
<pre class="r"><code>filter(gapminder, country == &#39;Nigeria&#39;)</code></pre>
<pre><code># A tibble: 12 × 6
   country  year       pop continent life_exp gdp_per_cap
   &lt;chr&gt;   &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1 Nigeria  1952  33119096 Africa        36.3       1077.
 2 Nigeria  1957  37173340 Africa        37.8       1101.
 3 Nigeria  1962  41871351 Africa        39.4       1151.
 4 Nigeria  1967  47287752 Africa        41.0       1015.
 5 Nigeria  1972  53740085 Africa        42.8       1698.
 6 Nigeria  1977  62209173 Africa        44.5       1982.
 7 Nigeria  1982  73039376 Africa        45.8       1577.
 8 Nigeria  1987  81551520 Africa        46.9       1385.
 9 Nigeria  1992  93364244 Africa        47.5       1620.
10 Nigeria  1997 106207839 Africa        47.5       1625.
11 Nigeria  2002 119901274 Africa        46.6       1615.
12 Nigeria  2007 135031164 Africa        46.9       2014.</code></pre>
<p><code>filter()</code> will keep all the rows that match the
conditions that are provided. Here are a few examples:</p>
<pre class="r"><code># rows for which the country column contains Vietnam or Indonesia
filter(gapminder, country %in% c(&#39;Vietnam&#39;, &#39;Indonesia&#39;))</code></pre>
<pre><code># A tibble: 24 × 6
   country    year       pop continent life_exp gdp_per_cap
   &lt;chr&gt;     &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1 Indonesia  1952  82052000 Asia          37.5        750.
 2 Indonesia  1957  90124000 Asia          39.9        859.
 3 Indonesia  1962  99028000 Asia          42.5        849.
 4 Indonesia  1967 109343000 Asia          46.0        762.
 5 Indonesia  1972 121282000 Asia          49.2       1111.
 6 Indonesia  1977 136725000 Asia          52.7       1383.
 7 Indonesia  1982 153343000 Asia          56.2       1517.
 8 Indonesia  1987 169276000 Asia          60.1       1748.
 9 Indonesia  1992 184816000 Asia          62.7       2383.
10 Indonesia  1997 199278000 Asia          66.0       3119.
# … with 14 more rows</code></pre>
<pre class="r"><code># rows with life_exp greater than or equal to 70
filter(gapminder, life_exp &gt;= 70)</code></pre>
<pre><code># A tibble: 494 × 6
   country    year      pop continent life_exp gdp_per_cap
   &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1 Albania    1982  2780097 Europe        70.4       3631.
 2 Albania    1987  3075321 Europe        72         3739.
 3 Albania    1992  3326498 Europe        71.6       2497.
 4 Albania    1997  3428038 Europe        73.0       3193.
 5 Albania    2002  3508512 Europe        75.7       4604.
 6 Albania    2007  3600523 Europe        76.4       5937.
 7 Algeria    2002 31287142 Africa        71.0       5288.
 8 Algeria    2007 33333216 Africa        72.3       6223.
 9 Argentina  1987 31620918 Americas      70.8       9140.
10 Argentina  1992 33958947 Americas      71.9       9308.
# … with 484 more rows</code></pre>
<p><code>filter()</code> allows you to combine multiple conditions. You
can separate them using a <code>,</code> as arguments to the function,
they will be combined using the <code>&amp;</code> (AND) logical
operator. If you need to use the <code>|</code> (OR) logical operator,
you can specify it explicitly:</p>
<pre class="r"><code># this is equivalent to:
#   filter(gapminder, country == &quot;Germany&quot; &amp; year &gt;= 1980)
filter(gapminder, country == &quot;Germany&quot;, year &gt;= 1980)</code></pre>
<pre><code># A tibble: 6 × 6
  country  year      pop continent life_exp gdp_per_cap
  &lt;chr&gt;   &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1 Germany  1982 78335266 Europe        73.8      22032.
2 Germany  1987 77718298 Europe        74.8      24639.
3 Germany  1992 80597764 Europe        76.1      26505.
4 Germany  1997 82011073 Europe        77.3      27789.
5 Germany  2002 82350671 Europe        78.7      30036.
6 Germany  2007 82400996 Europe        79.4      32170.</code></pre>
<pre class="r"><code># using `|` logical operator
filter(gapminder, year &gt;= 1990, (country == &quot;Australia&quot; | country == &#39;Mauritius&#39;))</code></pre>
<pre><code># A tibble: 8 × 6
  country    year      pop continent life_exp gdp_per_cap
  &lt;chr&gt;     &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1 Australia  1992 17481977 Oceania       77.6      23425.
2 Australia  1997 18565243 Oceania       78.8      26998.
3 Australia  2002 19546792 Oceania       80.4      30688.
4 Australia  2007 20434176 Oceania       81.2      34435.
5 Mauritius  1992  1096202 Africa        69.7       6058.
6 Mauritius  1997  1149818 Africa        70.7       7426.
7 Mauritius  2002  1200206 Africa        72.0       9022.
8 Mauritius  2007  1250882 Africa        72.8      10957.</code></pre>
<blockquote>
<h2 id="challenge-1">Challenge</h2>
<p>Select all data for countries in Europe between the years 1990 and
2000</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<pre class="r"><code>filter(gapminder, continent == &#39;Europe&#39;, (year &gt;= 1990 &amp; year &lt;= 2000))</code></pre>
<pre><code># A tibble: 60 × 6
   country                 year      pop continent life_exp gdp_per_cap
   &lt;chr&gt;                  &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;
 1 Albania                 1992  3326498 Europe        71.6       2497.
 2 Albania                 1997  3428038 Europe        73.0       3193.
 3 Austria                 1992  7914969 Europe        76.0      27042.
 4 Austria                 1997  8069876 Europe        77.5      29096.
 5 Belgium                 1992 10045622 Europe        76.5      25576.
 6 Belgium                 1997 10199787 Europe        77.5      27561.
 7 Bosnia and Herzegovina  1992  4256013 Europe        72.2       2547.
 8 Bosnia and Herzegovina  1997  3607000 Europe        73.2       4766.
 9 Bulgaria                1992  8658506 Europe        71.2       6303.
10 Bulgaria                1997  8066057 Europe        70.3       5970.
# … with 50 more rows</code></pre>
</details>
<p><br></p>
</div>
<div id="pipes" class="section level3">
<h3>Pipes</h3>
<p>But what if you wanted to select and filter? We can do this with
pipes (which we saw in the <code>bash</code> episode). Pipes, are a
fairly recent addition to R. Pipes let you take the output of one
function and send it directly to the next, which is useful when you need
to many things to the same data set. Pipes in R look like
<code>%&gt;%</code> (recall they looked like <code>|</code> in
<code>bash</code>) and are available via the <code>magrittr</code>
package, which is installed as part of <code>dplyr</code>. If you use
RStudio, you can type the pipe with <kbd>Ctrl</kbd> + <kbd>Shift</kbd> +
<kbd>M</kbd> if you’re using a PC, or <kbd>Cmd</kbd> + <kbd>Shift</kbd>
+ <kbd>M</kbd> if you’re using a Mac.</p>
<pre class="r"><code>gapminder %&gt;%
    filter(country == &quot;Spain&quot;) %&gt;%
    select(year, pop, life_exp)</code></pre>
<pre><code># A tibble: 12 × 3
    year      pop life_exp
   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1952 28549870     64.9
 2  1957 29841614     66.7
 3  1962 31158061     69.7
 4  1967 32850275     71.4
 5  1972 34513161     73.1
 6  1977 36439000     74.4
 7  1982 37983310     76.3
 8  1987 38880702     76.9
 9  1992 39549438     77.6
10  1997 39855442     78.8
11  2002 40152517     79.8
12  2007 40448191     80.9</code></pre>
<p>In the above code, we use the pipe to send the <code>gapminder</code>
dataset first through <code>filter()</code>, to keep rows where
<code>country</code> matches a particular country, and then through
<code>select()</code> to keep only the <code>year</code>,
<code>pop</code>, and <code>life_exp</code> columns. Since
<code>%&gt;%</code> takes the object on its left and passes it as the
first argument to the function on its right, we don’t need to explicitly
include the data frame as an argument to the <code>filter()</code> and
<code>select()</code> functions any more.</p>
<p>Some may find it helpful to read the pipe like the word “then”. For
instance, in the above example, we took the data frame
<code>gapminder</code>, <em>then</em> we <code>filter</code>ed for rows
where <code>country</code> was Spain, <em>then</em> we
<code>select</code>ed the <code>year</code>, <code>pop</code>, and
<code>life_exp</code> columns, <em>then</em> we showed only the first
six rows. The <strong><code>dplyr</code></strong> functions by
themselves are somewhat simple, but by combining them into linear
workflows with the pipe, we can accomplish more complex manipulations of
data frames.</p>
<p>If we want to create a new object with this smaller version of the
data we can do so by assigning it a new name:</p>
<pre class="r"><code>spain_gapminder &lt;- gapminder %&gt;%
    filter(country == &quot;Spain&quot;) %&gt;%
    select(year, pop, life_exp)</code></pre>
<p>This new object includes all of the data from this sample. Let’s look
at just the first six rows to confirm it’s what we want:</p>
<pre class="r"><code>spain_gapminder</code></pre>
<pre><code># A tibble: 12 × 3
    year      pop life_exp
   &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1952 28549870     64.9
 2  1957 29841614     66.7
 3  1962 31158061     69.7
 4  1967 32850275     71.4
 5  1972 34513161     73.1
 6  1977 36439000     74.4
 7  1982 37983310     76.3
 8  1987 38880702     76.9
 9  1992 39549438     77.6
10  1997 39855442     78.8
11  2002 40152517     79.8
12  2007 40448191     80.9</code></pre>
<p>Similar to <code>head()</code> and <code>tail()</code> functions, we
can also look at the first or last six rows using tidyverse function
<code>slice()</code>. Slice is a more versatile function that allows
users to specify a range to view:</p>
<pre class="r"><code>spain_gapminder %&gt;% slice(1:6)</code></pre>
<pre><code># A tibble: 6 × 3
   year      pop life_exp
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1  1952 28549870     64.9
2  1957 29841614     66.7
3  1962 31158061     69.7
4  1967 32850275     71.4
5  1972 34513161     73.1
6  1977 36439000     74.4</code></pre>
<pre class="r"><code>spain_gapminder %&gt;% slice(7:11)</code></pre>
<pre><code># A tibble: 5 × 3
   year      pop life_exp
  &lt;int&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1  1982 37983310     76.3
2  1987 38880702     76.9
3  1992 39549438     77.6
4  1997 39855442     78.8
5  2002 40152517     79.8</code></pre>
<blockquote>
<h2 id="exercise-pipe-and-filter">Exercise: Pipe and filter</h2>
<p>Starting with the <code>gapminder</code> data frame, use pipes to
subset the data to include only observations from Panama, where the year
is at least 1980. Showing only the 4th through 6th rows of columns
<code>country</code>, <code>year</code>, and
<code>gdp_per_cap</code>.</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<pre class="r"><code>gapminder %&gt;%
    filter(country == &quot;Panama&quot; &amp; year &gt;= 1980) %&gt;%
    slice(4:6) %&gt;%
    select(country, year, gdp_per_cap)</code></pre>
<pre><code># A tibble: 3 × 3
  country  year gdp_per_cap
  &lt;chr&gt;   &lt;int&gt;       &lt;dbl&gt;
1 Panama   1997       7114.
2 Panama   2002       7356.
3 Panama   2007       9809.</code></pre>
</details>
<p><br></p>
</div>
<div id="mutate" class="section level3">
<h3>Mutate</h3>
<p>Frequently you’ll want to create new columns based on the values in
existing columns, for example to do unit conversions or find the ratio
of values in two columns. For this we’ll use the <code>dplyr</code>
function <code>mutate()</code>.</p>
<p>We have a column titled “gdp_per_cap” and “pop”. We could use these
two columns to compute the “total_gdp” for each country/year
observation. By multiplying the entries per-row.</p>
<p>Let’s add a column (<code>total_gdp</code>) to our
<code>gapminder</code> data frame that shows the total GDP for the
country in the corresponding year.</p>
<pre class="r"><code>gapminder %&gt;% mutate(total_gdp = gdp_per_cap * pop)</code></pre>
<pre><code># A tibble: 1,704 × 7
   country      year      pop continent life_exp gdp_per_cap    total_gdp
   &lt;chr&gt;       &lt;int&gt;    &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
 1 Afghanistan  1952  8425333 Asia          28.8        779.  6567086330.
 2 Afghanistan  1957  9240934 Asia          30.3        821.  7585448670.
 3 Afghanistan  1962 10267083 Asia          32.0        853.  8758855797.
 4 Afghanistan  1967 11537966 Asia          34.0        836.  9648014150.
 5 Afghanistan  1972 13079460 Asia          36.1        740.  9678553274.
 6 Afghanistan  1977 14880372 Asia          38.4        786. 11697659231.
 7 Afghanistan  1982 12881816 Asia          39.9        978. 12598563401.
 8 Afghanistan  1987 13867957 Asia          40.8        852. 11820990309.
 9 Afghanistan  1992 16317921 Asia          41.7        649. 10595901589.
10 Afghanistan  1997 22227415 Asia          41.8        635. 14121995875.
# … with 1,694 more rows</code></pre>
<blockquote>
<h2 id="exercise">Exercise</h2>
<p>There is data for a lot of countries and years, so let’s look just at
the results of the United States by adding the correct line to the above
code.</p>
</blockquote>
<details>
<summary>
Solution
</summary>
<pre class="r"><code>gapminder %&gt;%
    mutate(total_gdp = gdp_per_cap * pop) %&gt;%
    filter(country == &#39;United States&#39;)</code></pre>
<pre><code># A tibble: 12 × 7
   country        year       pop continent life_exp gdp_per_cap total_gdp
   &lt;chr&gt;         &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
 1 United States  1952 157553000 Americas      68.4      13990.   2.20e12
 2 United States  1957 171984000 Americas      69.5      14847.   2.55e12
 3 United States  1962 186538000 Americas      70.2      16173.   3.02e12
 4 United States  1967 198712000 Americas      70.8      19530.   3.88e12
 5 United States  1972 209896000 Americas      71.3      21806.   4.58e12
 6 United States  1977 220239000 Americas      73.4      24073.   5.30e12
 7 United States  1982 232187835 Americas      74.6      25010.   5.81e12
 8 United States  1987 242803533 Americas      75.0      29884.   7.26e12
 9 United States  1992 256894189 Americas      76.1      32004.   8.22e12
10 United States  1997 272911760 Americas      76.8      35767.   9.76e12
11 United States  2002 287675526 Americas      77.3      39097.   1.12e13
12 United States  2007 301139947 Americas      78.2      42952.   1.29e13</code></pre>
</details>
<p><br></p>
</div>
<div id="group_by-and-summarize-functions" class="section level3">
<h3>group_by() and summarize() functions</h3>
<p>Many data analysis tasks can be approached using the
“split-apply-combine” paradigm: split the data into groups, apply some
analysis to each group, and then combine the results. <code>dplyr</code>
makes this very easy through the use of the <code>group_by()</code>
function, which splits the data into groups. When the data is grouped in
this way <code>summarize()</code> can be used to collapse each group
into a single-row summary. <code>summarize()</code> does this by
applying an aggregating or summary function to each group. For example,
if we wanted to group by continent and find the number of rows of data
for each continent, we would do:</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(continent) %&gt;%
    summarize(n())</code></pre>
<pre><code># A tibble: 5 × 2
  continent `n()`
  &lt;chr&gt;     &lt;int&gt;
1 Africa      624
2 Americas    300
3 Asia        396
4 Europe      360
5 Oceania      24</code></pre>
<p>Notice this is the same results as when we ran
<code>summary(gapminder$continent)</code>.</p>
<p>It can be a bit tricky at first, but we can imagine splitting the
data frame by groups and applying a certain function to summarize the
data.</p>
<center>
<img src="images/split_apply_combine.png" alt="rstudio default session" style="width: 500px;"/>
</center>
<p><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Here the summary function used was <code>n()</code> to find the count
for each group. Since this is a quite a common operation, there is a
simpler method called <code>tally()</code>:</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(country) %&gt;%
    tally()</code></pre>
<pre><code># A tibble: 142 × 2
   country         n
   &lt;chr&gt;       &lt;int&gt;
 1 Afghanistan    12
 2 Albania        12
 3 Algeria        12
 4 Angola         12
 5 Argentina      12
 6 Australia      12
 7 Austria        12
 8 Bahrain        12
 9 Bangladesh     12
10 Belgium        12
# … with 132 more rows</code></pre>
<p>To show that there are many ways to achieve the same results, there
is another way to approach this, which bypasses <code>group_by()</code>
using the function <code>count()</code>:</p>
<pre class="r"><code>gapminder %&gt;% count(country)</code></pre>
<pre><code># A tibble: 142 × 2
   country         n
   &lt;chr&gt;       &lt;int&gt;
 1 Afghanistan    12
 2 Albania        12
 3 Algeria        12
 4 Angola         12
 5 Argentina      12
 6 Australia      12
 7 Austria        12
 8 Bahrain        12
 9 Bangladesh     12
10 Belgium        12
# … with 132 more rows</code></pre>
<p>We can also apply many other functions to individual columns to get
other summary statistics. For example,we can use built-in functions like
<code>mean()</code>, <code>median()</code>, <code>min()</code>, and
<code>max()</code>. These are called “built-in functions” because they
come with R and don’t require that you install any additional packages.
By default, all <strong>R functions operating on vectors that contains
missing data will return NA</strong>. It’s a way to make sure that users
know they have missing data, and make a conscious decision on how to
deal with it. When dealing with simple statistics like the mean, the
easiest way to ignore <code>NA</code> (the missing data) is to use
<code>na.rm = TRUE</code> (<code>rm</code> stands for remove).</p>
<p>So to view the mean, median, maximum, and minimum
<code>gdp_per_cap</code> for each country:</p>
<pre class="r"><code>gapminder %&gt;%
    group_by(country) %&gt;%
    summarize(
        min_gpc = min(gdp_per_cap),
        mean_gpc = mean(gdp_per_cap),
        median_gpc = median(gdp_per_cap),
        max_gpc = max(gdp_per_cap))</code></pre>
<pre><code># A tibble: 142 × 5
   country     min_gpc mean_gpc median_gpc max_gpc
   &lt;chr&gt;         &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
 1 Afghanistan    635.     803.       803.    978.
 2 Albania       1601.    3255.      3253.   5937.
 3 Algeria       2449.    4426.      4854.   6223.
 4 Angola        2277.    3607.      3265.   5523.
 5 Argentina     5911.    8956.      9069.  12779.
 6 Australia    10040.   19981.     18906.  34435.
 7 Austria       6137.   20412.     20673.  36126.
 8 Bahrain       9867.   18078.     18780.  29796.
 9 Bangladesh     630.     818.       704.   1391.
10 Belgium       8343.   19901.     20049.  33693.
# … with 132 more rows</code></pre>
</div>
<div id="reshaping-data-frames" class="section level3">
<h3>Reshaping data frames</h3>
<p>It can sometimes be useful to transform the “long” tidy format, into
the wide format. This transformation can be done with the
<code>pivot_wider()</code> function provided by the <code>tidyr</code>
package (also part of the <code>tidyverse</code>).</p>
<p><code>pivot_wider()</code> takes a data frame as the first argument,
and two arguments: the column name that will become the columns and the
column name that will become the cells in the wide data. Let’s create a
wide format table with rows for each country, columns for each year, and
data values being the life_exp.</p>
<pre class="r"><code>gapminder_wide &lt;- gapminder %&gt;%
    select(country, life_exp, year) %&gt;%
    group_by(country) %&gt;%
    pivot_wider(names_from = year, values_from = life_exp)
gapminder_wide</code></pre>
<pre><code># A tibble: 142 × 13
# Groups:   country [142]
   country `1952` `1957` `1962` `1967` `1972` `1977` `1982` `1987` `1992` `1997`
   &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
 1 Afghan…   28.8   30.3   32.0   34.0   36.1   38.4   39.9   40.8   41.7   41.8
 2 Albania   55.2   59.3   64.8   66.2   67.7   68.9   70.4   72     71.6   73.0
 3 Algeria   43.1   45.7   48.3   51.4   54.5   58.0   61.4   65.8   67.7   69.2
 4 Angola    30.0   32.0   34     36.0   37.9   39.5   39.9   39.9   40.6   41.0
 5 Argent…   62.5   64.4   65.1   65.6   67.1   68.5   69.9   70.8   71.9   73.3
 6 Austra…   69.1   70.3   70.9   71.1   71.9   73.5   74.7   76.3   77.6   78.8
 7 Austria   66.8   67.5   69.5   70.1   70.6   72.2   73.2   74.9   76.0   77.5
 8 Bahrain   50.9   53.8   56.9   59.9   63.3   65.6   69.1   70.8   72.6   73.9
 9 Bangla…   37.5   39.3   41.2   43.5   45.3   46.9   50.0   52.8   56.0   59.4
10 Belgium   68     69.2   70.2   70.9   71.4   72.8   73.9   75.4   76.5   77.5
# … with 132 more rows, and 2 more variables: 2002 &lt;dbl&gt;, 2007 &lt;dbl&gt;</code></pre>
<p>The opposite operation of <code>pivot_wider()</code> is taken care by
<code>pivot_longer()</code>. We specify the names of the new columns,
and here add <code>-CHROM</code> as this column shouldn’t be affected by
the reshaping:</p>
<pre class="r"><code>gapminder_wide %&gt;%
    pivot_longer(-country, names_to = &quot;year&quot;, values_to = &quot;life_exp&quot;)</code></pre>
<pre><code># A tibble: 1,704 × 3
# Groups:   country [142]
   country     year  life_exp
   &lt;chr&gt;       &lt;chr&gt;    &lt;dbl&gt;
 1 Afghanistan 1952      28.8
 2 Afghanistan 1957      30.3
 3 Afghanistan 1962      32.0
 4 Afghanistan 1967      34.0
 5 Afghanistan 1972      36.1
 6 Afghanistan 1977      38.4
 7 Afghanistan 1982      39.9
 8 Afghanistan 1987      40.8
 9 Afghanistan 1992      41.7
10 Afghanistan 1997      41.8
# … with 1,694 more rows</code></pre>
</div>
<div id="resources" class="section level3">
<h3>Resources</h3>
<ul>
<li><p><a
href="https://github.com/rstudio/cheatsheets/raw/master/data-transformation.pdf">Handy
dplyr cheatsheet</a></p></li>
<li><p><a href="http://usepa.github.io/introR/2015/01/14/03-Clean/">Much
of this lesson was copied or adapted from Jeff Hollister’s
materials</a></p></li>
</ul>
</div>
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>The figure was adapted from the Software Carpentry
lesson, <a
href="https://swcarpentry.github.io/r-novice-gapminder/13-dplyr/">R for
Reproducible Scientific Analysis</a><a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
</ol>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
